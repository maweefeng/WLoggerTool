<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <script src="https://unpkg.com/vue@next"></script>
  <!-- import CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
  <!-- import JavaScript -->
  <script src="https://unpkg.com/element-plus"></script>
  <script src="./default.js"></script>

  <style>
    .el-table .cell {
      display: inline-block;
      white-space: nowrap;
      text-overflow: ellipsis;
      line-break: auto;
      max-lines: 1;
      max-width: 180px;
      font-size: small;
      line-height: 40px;
    }
  </style>
  <title>日志分析终端</title>

</head>

<body>
  <div id="app">
    <div align="center">
      <el-input id="input01" type="text" placeholder="请选择文件" v-model="fileName"></el-input>
      <p></p>
      <el-button type="primary" v-on:click="openFile()" round>选择文件</el-button>
      <input type="file" id="fileInput" style="display:none" @change="showRealPath" />
    </div>
    <p></p>

    <el-button @click="allLog">所有日志</el-button>
    <el-button @click="filterError">错误日志</el-button>
    <el-button @click="clearFilter">清除所有过滤器</el-button>
    <el-input v-model="input" placeholder="请输入内容" style="width: 200; margin-left: 15;" size="medium"></el-input>
    <p></p>
    <el-table class="tableBox" ref="filterTable" :row-style="rowStyle" :cell-style="{padding: '5'}" :data="tableData"
      style="width: 100%; height: 50%; line-height: 30px; max-lines: 1;" id="filterTable">
      <el-table-column prop="time" label="时间" sortable width="150" height="30" style="height: 30; max-lines: 1;"
        column-key="date">
      </el-table-column>
      <el-table-column prop="code" label="位置" style="height: 30px; word-wrap: break-word; max-lines: 1;" height="30"
        min-width="180">
      </el-table-column>
      <el-table-column prop="module" label="模块" style="height: 30px; word-wrap: break-word; max-lines: 1;" height="30"
        width="180">
      </el-table-column>
      <el-table-column prop="action" label="事件" style="height: 30px; word-wrap: break-word; max-lines: 1;" height="30"
        min-width="180">
      </el-table-column>
      <el-table-column prop="stage" label="阶段" style="height: 30px; word-wrap: break-word; max-lines: 1;" height="30"
        min-width="180">
      </el-table-column>
      <el-table-column prop="status" label="状态" style="height: 30px; word-wrap: break-word; max-lines: 1;" height="30"
        width="180">
      </el-table-column>
      <el-table-column prop="info" label="备注" style="height: 30px; word-wrap: break-word; max-lines: 1;" height="30"
        min-width="180">
      </el-table-column>
      <el-table-column prop="level" label="等级" style="height: 30px; word-wrap: break-word; max-lines: 1;" height="30"
        width="100" :filters="logLevel" :filter-method="filterTag" filter-placement="bottom-end">
      </el-table-column>
    </el-table>
    <div align="center">
      <p>控制台</p>
    </div>
  </div>
  <script>
    const App = {
      data() {
        return {
          input: '',
          fileName: '',
          tableData: [],
          logLevel: [{
              text: 'ERROR',
              value: '[E]'
            },
            {
              text: 'WARNING',
              value: '[W]'
            },
            {
              text: 'VERBOSE',
              value: '[V]'
            },
            {
              text: 'DEBUG',
              value: '[D]'
            },
            {
              text: 'INFO',
              value: '[I]'
            }
          ],
          allData: []
        }
      },
      methods: {
        rowStyle({
          row,
          rowIndex
        }) {
          let stylejson = {

          }

          if (row.level == "[E]") {
            stylejson.color = 'red'
            return stylejson
          } else {
            return ''
          }
        },
        clearFilter() {
          this.$refs.filterTable.clearFilter();
          this.tableData = this.allData;
        },
        formatter(row, column) {
          return row.address;
        },
        allLog() {
          this.tableData = this.allData;
        },
        analyse: function () {

        },
        filterError: function () {
          var datas1 = [{}]
          for (var i = 0; i < this.allData.length; i++) {
            if (this.allData[i]['level'] == '[E]') {
              datas1.push(this.allData[i]);
            }
          }
          this.tableData = datas1
        },
        openFile: function () {
          document.getElementById('fileInput').click()
          analyse()
        },
        filterTag(value, row) {
          return row.level === value;
        },
        filterHandler(value, row, column) {
          const property = column['property'];
          return row[property] === value;
        },
        showRealPath: function () {
          var files = document.getElementById('fileInput').files
          var paths = ''
          for (var i = 0; i < files.length; i++) {
            paths += (files[i].name + '\n')
          }
          this.fileName = paths
          const reader = new FileReader()
          reader.readAsText(files[0], 'utf8')
          reader.onload = (event) => {
            this.allData = logAnalyse(event.target.result)
            this.tableData = logAnalyse(event.target.result)
          }
        }
      },
    };
    const app = Vue.createApp(App);
    app.use(ElementPlus);
    app.mount("#app");
  </script>
</body>

</html>